<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Online Compiler (Python, C, C++, Java, JS)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1020;--panel:#121a33;--muted:#8ea0c2;--text:#e8efff;--accent:#6aa0ff;--accent2:#8bffdf;--warn:#ffca6e;--err:#ff7a7a;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    header{
      display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:16px
    }
    h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.2px}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .col{flex:1 1 520px}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.22)
    }
    label{display:block;margin:0 0 8px 2px;color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.15em}
    select,input,textarea,button{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0e1530;color:var(--text);
      outline:none
    }
    textarea{min-height:360px;resize:vertical;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,"Courier New",monospace;font-size:14px}
    .row-slim{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    .row-slim > *{flex:1}
    .btn{
      width:auto;cursor:pointer;background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#071220;border:none;font-weight:700;letter-spacing:.3px;padding:10px 16px
    }
    .btn:disabled{opacity:.55;cursor:not-allowed;filter:grayscale(30%)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,"Courier New",monospace;white-space:pre-wrap}
    .output{min-height:180px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0f1738;border:1px solid rgba(255,255,255,.1);color:var(--muted);font-size:12px}
    .badge{padding:4px 8px;border-radius:999px;background:#0d1533;border:1px solid rgba(255,255,255,.1);font-size:12px;color:var(--muted)}
    .muted{color:var(--muted)}
    .ok{color:#9dffbc}
    .warn{color:var(--warn)}
    .err{color:var(--err)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>‚öôÔ∏è Online Compiler</h1>
      <div class="pill" id="statusPill">API: checking‚Ä¶</div>
    </header>

    <div class="row">
      <div class="col">
        <div class="card">
          <label for="language">Language</label>
          <div class="grid2">
            <select id="language">
              <option value="python">Python</option>
              <option value="javascript">JavaScript (Node)</option>
              <option value="c">C (gcc)</option>
              <option value="cpp">C++ (g++)</option>
              <option value="java">Java</option>
            </select>
            <input id="version" placeholder="version (latest)" />
          </div>

          <label for="code" style="margin-top:10px">Code</label>
          <textarea id="code" spellcheck="false"></textarea>

          <div class="row-slim">
            <input id="stdin" placeholder="Optional stdin (passed to your program)" />
          </div>

          <div class="row-slim" style="justify-content:space-between">
            <div class="badge">Runs on: <span class="muted">Piston API @ Render</span></div>
            <div>
              <button id="runBtn" class="btn">‚ñ∂ Run</button>
              <button id="resetBtn" class="btn" style="background:linear-gradient(135deg,#b6c8ff,#e0e6ff);margin-left:8px">‚Ü∫ Reset</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <label>Result</label>
          <div class="mono output" id="output">üëá Press ‚ÄúRun‚Äù. Results appear here.</div>
          <div class="grid2" style="margin-top:8px">
            <div class="card" style="padding:10px">
              <div class="muted" style="font-size:12px;margin-bottom:4px">Exit code</div>
              <div id="exitCode" class="mono">‚Äî</div>
            </div>
            <div class="card" style="padding:10px">
              <div class="muted" style="font-size:12px;margin-bottom:4px">Time / Memory</div>
              <div id="perf" class="mono">‚Äî</div>
            </div>
          </div>
          <div class="muted" style="margin-top:10px;font-size:12px">Tips: your API is <span id="apiUrlLabel" class="mono"></span>. CORS must be enabled on the API (you already added <span class="mono">cors</span>).</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // üîó your API base (Render)
    const API_BASE = "https://tj-piston-api.onrender.com";
    const EXECUTE_URL = API_BASE + "/api/v2/execute";
    document.getElementById("apiUrlLabel").textContent = EXECUTE_URL;

    // üéØ sensible filename + starter templates per language
    const templates = {
      python: {
        filename: "main.py",
        code: `# Python 3\nprint("Hello from Python!")`
      },
      javascript: {
        filename: "main.js",
        code: `// Node.js\nconsole.log("Hello from JavaScript!");`
      },
      c: {
        filename: "main.c",
        code: `#include <stdio.h>\nint main(){ printf("Hello from C!\\n"); return 0; }`
      },
      cpp: {
        filename: "main.cpp",
        code: `#include <bits/stdc++.h>\nusing namespace std; int main(){ cout<<"Hello from C++!\\n"; return 0; }`
      },
      java: {
        filename: "Main.java",
        // class **must** be Main for piston java default
        code: `public class Main{ public static void main(String[] args){ System.out.println("Hello from Java!"); } }`
      }
    };

    // üß™ load a default template
    const langSel = document.getElementById("language");
    const codeEl = document.getElementById("code");
    const stdinEl = document.getElementById("stdin");
    const versionEl = document.getElementById("version");
    const outEl = document.getElementById("output");
    const exitEl = document.getElementById("exitCode");
    const perfEl = document.getElementById("perf");
    const runBtn = document.getElementById("runBtn");
    const resetBtn = document.getElementById("resetBtn");
    const statusPill = document.getElementById("statusPill");

    function loadTemplate(lang){
      const t = templates[lang];
      codeEl.value = t.code;
      stdinEl.value = "";
      versionEl.value = "latest";
      outEl.textContent = "üëá Press ‚ÄúRun‚Äù. Results appear here.";
      exitEl.textContent = "‚Äî";
      perfEl.textContent = "‚Äî";
    }
    loadTemplate(langSel.value);

    langSel.addEventListener("change", e => loadTemplate(e.target.value));
    resetBtn.addEventListener("click", () => loadTemplate(langSel.value));

    // üå°Ô∏è quick health check
    (async function checkApi(){
      try{
        // GET / should respond with { message: 'Piston v...' }
        const r = await fetch(API_BASE+"/");
        if(!r.ok) throw new Error();
        statusPill.textContent = "API: online";
        statusPill.style.color = "#9dffbc";
      }catch{
        statusPill.textContent = "API: offline";
        statusPill.style.color = "#ff7a7a";
      }
    })();

    // üöÄ run code via Piston
    runBtn.addEventListener("click", async () => {
      const language = langSel.value;
      const version = (versionEl.value || "latest").trim();
      const filename = templates[language].filename;
      const code = codeEl.value;
      const stdin = stdinEl.value;

      runBtn.disabled = true;
      runBtn.textContent = "Running‚Ä¶";

      outEl.innerHTML = `<span class="muted">Sending request to API‚Ä¶</span>`;

      // piston payload
      const payload = {
        language,
        version,
        files: [{ name: filename, content: code }],
        stdin
      };

      try{
        const res = await fetch(EXECUTE_URL, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        if(!res.ok){
          const txt = await res.text();
          throw new Error(`HTTP ${res.status}: ${txt}`);
        }

        const data = await res.json();

        // Piston returns compile + run sections (compile optional)
        const compile = data.compile || {};
        const run = data.run || {};

        // pretty print result
        let html = "";
        if(compile.stdout){ html += `\n<span class="ok">[compile stdout]</span>\n${escapeHTML(compile.stdout)}\n`; }
        if(compile.stderr){ html += `\n<span class="warn">[compile stderr]</span>\n${escapeHTML(compile.stderr)}\n`; }
        if(run.stdout){ html += `\n<span class="ok">[stdout]</span>\n${escapeHTML(run.stdout)}\n`; }
        if(run.stderr){ html += `\n<span class="err">[stderr]</span>\n${escapeHTML(run.stderr)}\n`; }

        if(!html.trim()) html = `<span class="muted">No output.</span>`;

        outEl.innerHTML = html.trim();
        exitEl.textContent = (run.code ?? "‚Äî");
        const t = (run && (run.signal || run.time || run.memory)) ? `${run.time ?? "‚Äî"}s, ${formatBytes(run.memory ?? 0)}` : "‚Äî";
        perfEl.textContent = t;
      }catch(err){
        outEl.innerHTML = `<span class="err">Request failed:</span>\n${escapeHTML(String(err.message || err))}`;
        exitEl.textContent = "‚Äî";
        perfEl.textContent = "‚Äî";
      }finally{
        runBtn.disabled = false;
        runBtn.textContent = "‚ñ∂ Run";
      }
    });

    function escapeHTML(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function formatBytes(b){
      if(!b) return "0 B";
      const u=["B","KB","MB","GB"]; let i=0;
      while(b>=1024 && i<u.length-1){ b/=1024; i++; }
      return `${b.toFixed(1)} ${u[i]}`;
    }
  </script>
</body>
</html>
